# This script is for simulation using JModelica.org
from pymodelica import compile_fmu
from pyfmi import load_fmu

print 'Loaded python packages from JModelica.'
# Compile .mo file to fmu executable
print 'Compiling Modelica model...'
fmu_name = compile_fmu('<%-modelName%>', '<%-modelName%>.mo')
print 'Compilation done!'

# Load the compiled fmu
print 'Loading in compiled model...'
model = load_fmu(fmu_name)
print 'Compiled model loaded!'

# Simulate the model
print 'Simulating model (this may take a while)...'
res = model.simulate(final_time=<%-stopTime%>)

# TODO: Handle the result properly based on res-variable
import json
with open('<%-modelName%>_res.json', 'w') as outfile:
    json.dump({}, outfile)

with open('<%-modelName%>_res.csv', 'w') as outfile:
    outfile.write('hello')
